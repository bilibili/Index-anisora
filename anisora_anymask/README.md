##  ðŸš€ Quick Started

### 1. Environment Set Up

```bash
cd anisora_anymask
conda create -n wan_gpu python=3.10
conda activate wan_gpu
pip install -r req-fastvideo.txt
pip install -r requirements.txt
pip install -e .
```

### 2. Download Pretrained Weights

Please download AnisoraAnymask checkpoints from ðŸ¤— [Huggingface](https://huggingface.co/IndexTeam/Index-anisora/tree/main/anymask) 

```bash
git lfs install
git clone https://huggingface.co/Wan-AI/Wan2.1-I2V-14B-480P
```


### 3. Inference

### Generation Controlled by Spatial Masks

https://github.com/user-attachments/assets/65bb2b24-1541-428f-b26e-864056bee711

ï¼ˆThis sample id is from Phantom-video/HuMo/issues/9ï¼‰

#### Single-GPU Inference 

```bash
python generate-pi-i2v-any-mask1_spa.py \
    --task i2v-14B \
    --size 1280*720  \
    --ckpt_dir Wan2.1-I2V-14B-480P \
    --image ./output/anisora_anymask_spa \
    --prompt data/_spa_data/spa.txt \
    --base_seed 4096 \
    --frame_num 129 \
    --sample_steps 8 \
    --sample_shift 5 \
    --sample_guide_scale 1
```

#### Multi-GPU Inference

```bash
torchrun \
    --nproc_per_node=8 \
    --master_port 43210 \
    generate-pi-i2v-any-mask1_spa.py \
    --task i2v-14B \
    --size 1280*720  \
    --ckpt_dir Wan2.1-I2V-14B-480P \
    --image ./output/anisora_anymask_spa \
    --prompt data/_spa_data/spa.txt \
    --dit_fsdp \
    --t5_fsdp \
    --ulysses_size 8 \
    --base_seed 4096 \
    --frame_num 129 \
    --sample_steps 8 \
    --sample_shift 5 \
    --sample_guide_scale 1
```


### Temporal Frame Interpolation for Video Quality Enhancement

By controlling the spatiotemporal mask, frames are extracted from the source video as model input, enabling the model to repair shaking and artifacts in the input video.

https://github.com/user-attachments/assets/b636ca50-7e45-4996-93d6-3271636ab003

https://github.com/user-attachments/assets/642ae905-03bb-40c6-8f2d-1d095fa1941f

ï¼ˆThese two sample inputs are generated by sora2ï¼‰

#### Single-GPU Inference 

```bash
python generate-pi-i2v-any-mask1.py \
    --task i2v-14B \
    --size 1280*720  \
    --ckpt_dir Wan2.1-I2V-14B-480P \
    --image ./output/anisora_anymask_temp \
    --prompt data/_tem_data/test.txt \
    --base_seed 4096 \
    --frame_num 129 \
    --sample_steps 8 \
    --sample_shift 5 \
    --sample_guide_scale 1
```

#### Multi-GPU Inference

```bash
torchrun \
    --nproc_per_node=8 \
    --master_port 43210 \
    generate-pi-i2v-any-mask1.py \
    --task i2v-14B \
    --size 1280*720  \
    --ckpt_dir Wan2.1-I2V-14B-480P \
    --image ./output/anisora_anymask_temp \
    --prompt data/_tem_data/test.txt \
    --dit_fsdp \
    --t5_fsdp \
    --ulysses_size 8 \
    --base_seed 4096 \
    --frame_num 129 \
    --sample_steps 8 \
    --sample_shift 5 \
    --sample_guide_scale 1
```


